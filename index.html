<!DOCTYPE html>
<html>
    <head>
        <title>Anime QA</title>
        <link rel="icon" href="imgs/QA_icon.svg">

        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/vue"></script>
        <script src="https://unpkg.com/vue-router"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/vue-resource/1.2.0/vue-resource.js"></script>
        <script src="https://unpkg.com/element-ui@2.6.1/lib/index.js"></script>
        <script src="https://unpkg.com/lodash@4.16.0"></script>
        <script src="https://unpkg.com/http-vue-loader"></script>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

        <style>
            body {
                background-color: #fbfbfb;
            }
            #main-container {
                background-color: white;
                border-radius: 1em;
                box-shadow: #bbbbbb 0.2em 0.2em 0.5em;
                max-width: 600px; 
                padding: 1.2em;
                margin: 2em;
            }
            #heading {
                text-align: center; 
                font-weight: bold;
            }
            #tips {
                text-align: center;
                margin: 1em;
                color: #008568;
            }
            .result {
                margin-top: 1em;
            }
            .result-content {
                background-color: #e8f2ff;
            }
            .tooltip div {
                text-align:left;
            }
            .tooltip.show {
                opacity: 0.8!important;
                filter:alpha(opacity=80);
            }
        </style>
    </head>


    <body>
        <div id="main" style="width: 100vw; height: 100vh;" class="d-flex align-content-center flex-wrap justify-content-center align-self-center">
            <div class="container-sm" id="main-container">
                <h1 id="heading">二刺螈QA</h1>
                <div id="tips">
                    我能这么问 → 
                    <span style="cursor: pointer;" :title="tip"
                          data-toggle="tooltip" data-placement="top" data-html="true">
                        ✔
                    </span>
                </div>
                <div class="form-group">
                    <input v-model="question" class="form-control">
                </div>
                <button @click="ask" class="btn btn-primary" style="width: 100%;">
                    <span v-if="loading">
                        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                        {{loading_hint}}
                    </span>
                    <span v-else>
                        {{submit_text}}
                    </span>
                </button>
                <div class="collapse result" id="collapseExample">
                    <div class="card card-body result-content">
                        {{answer}}
                    </div>
                </div>
            </div>
        </div>

        <script>
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            })

            Vue.http.headers.common['Access-Control-Allow-Origin'] = '*';
            let vm = new Vue({
                el: "#main",
                data: {
                    question: "",
                    answer: "",
                    tip: "<div style='text-align:left'>【番剧】的（配音演员/角色）都有谁</br>【声优】配音过什么（番剧/角色）</br>【角色】是什么番剧的角色</br>【角色】的配音演员是谁</br>【番剧】的（画风/剧情/音乐）我很喜欢，有什么推荐</div>",
                    loading_hint: "在想了，你急个🔨",
                    submit_text: "👴很好奇！",
                    loading: false,
                    ask_cnt: 0
                },
                methods: {
                    ask: function() {
                        this.ask_cnt += 1;
                        if (this.ask_cnt > 3) {
                            this.loading_hint = "还问？你不会自个百度吗🙄";
                            this.submit_text = "👴就是很好奇！";
                        }

                        let url = "https://1354839170291685.ap-northeast-1.fc.aliyuncs.com/2016-08-15/proxy/anime-knowledge-graph/anime-qa/?question=" + encodeURIComponent(this.question);
                        $('.collapse').collapse("hide");
                        this.loading = true;
                        this.$http.get(url).then(res => {
                            if (res.body['success']) {
                                console.log("success");
                                this.answer = res.body["result"];
                                $('.collapse').collapse("show");
                            }
                            else {
                                alert(res.body["result"]);
                            }
                            this.loading = false;
                        }).except(e => {
                            this.loading = false;
                            alert(e.message);
                        })
                    }
                },
                mounted: function () {

                }
            })

            $(document).ready(function() {
                $("body").tooltip({ selector: '[data-toggle=tooltip]' });
            });
            $(function () {
                $('[data-toggle="tooltip"]').tooltip()
            })
        </script>
    </body>
</html>